# Система управления банковскими картами

**Версия**: 1.0м <br>
**Стек**: Spring Boot, Spring Security, JWT, PostgreSQL, Liquibase, Docker
***
## Описание проекта
Данный проект представляет собой систему управления банковскими картами,
обеспечивающую полный цикл работы с картами и безопасные переводы между ними.<br>

### Система реализует следующие возможности:
- Просмотр и управление картами
- Переводы между своими картами
- Управление пользователями (для администраторов)
- Поддержка ролей и безопасного доступа через JWT 
<br>
### Каждая карта включает следующие атрибуты:
- Номер карты: зашифрован, отображается маской **** **** **** 1234
- Владелец
- Срок действия
- Статус: Активна, Заблокирована, Истек срок
- Баланс
  Для администратора (ROLE_ADMIN):
***
## Возможности системы
### Для администратора (ROLE_ADMIN):
- Создание, блокировка, активация и удаление карт
- Управление пользователями
- Просмотр всех карт
### Для пользователя (ROLE_USER):
- Просмотр своих карт с поддержкой поиска и пагинации
- Запрос на блокировку карты
- Переводы между своими картами
- Просмотр баланса
***
## Аутентификация и безопасность
- Spring Security + **JWT**
- **Роли**: ADMIN, USER
- Шифрование данных
- Ролевой доступ к API
- Маскирование номеров карт для безопасного отображения
***
## API
### Система предоставляет REST API с поддержкой:
- CRUD операций для карт
- Переводов между своими картами
- Фильтрации и постраничной выдачи данных
- Валидации входных данных и подробных сообщений об ошибках
- Документация доступна через Swagger (по адресу http://localhost:8080/swagger-ui.html).
***
## Работа с базой данных
- PostgreSQL 
- Миграции через Liquibase (src/main/resources/db/migration)
- Использование UUID для идентификации пользователей и карт
- Тестовый сид с данными, для проверки работы функциональности
***
## Развертывание и тестирование
### Через Docker Compose (dev-среда)
```bash
docker-compose up --build

```
- Поднимает сервис, базу данных и все необходимые зависимости
- Автоматически применяет Liquibase миграции
## Тестирование
  - Юнит-тесты покрывают ключевую бизнес-логику:
    * Переводы между картами
    * Блокировка/активация карт
    * Проверка баланса
  - Юнит тесты покрывают так же и REST-котроллеры:
    * Проверка корректного возврата статуса
    * Корректный вызов сервисов
    * Правильно обработка входящих параметров
***
#### Структура проекта
```
src
+---main
|   +---java
|   |   \---com
|   |       \---example
|   |           \---bankcards
|   |               +---config      - Конфигурации: CORS, JWT, Security
|   |               +---controller  - REST контроллеры
|   |               +---dto         - Классы дял обмена данными между слоями
|   |               +---entity      - Основные сущности
|   |               +---exception   - Кастомные исключения их переъват и обработка
|   |               +---repository  - DAO слои для доступа к базе данных
|   |               +---security    - Сервисы: Jwt, UserDetails, Auth Service
|   |               +---service     - Сервисы с основной бизнес логикой
|   |               \---util        - Enums, Mappers's и кастомная валидация 
|   \---resources
|       +---db
|       |   \---migration
|       |       +---changelog - Регистрация файлов миграции в Liquebase
|       |       \---sql       - Файлы миграции
|       |           \---seed  - Тестовые миграции с данными
|       \---jwt
\---test
    \---java
        \---com
            \---example
                \---bankcards
                    +---controller - Тесты контроллеров
                    |   +---admin
                    |   |   +---bankcards
                    |   |   \---user
                    |   +---auth
                    |   \---user
                    \---service    - Тесты основной бизнес логики
```
***
## Пример запросов
- Просмотр своих карт (USER):
```http request
GET /api/v1/user/cards?page=0&size=10&search=134
Authorization: Bearer <JWT_TOKEN>
```
- Перевод между своими картами:
```http request
POST /api/v1/user/cards/transfer
Authorization: Bearer <JWT_TOKEN>
Content-Type: application/json

{
  "fromCardId": "uuid-123",
  "toCardId": "uuid-456",
  "amount": 100.50
}
```
## Особенности реализации
- Все номера карт хранятся в зашифрованном виде
- JWT токены позволяют безопасно идентифицировать пользователя
- Реализована пагинация и поиск для удобного просмотра карт
- Роли пользователя строго ограничивают доступ к API
- Используется Docker Compose для простого развертывания среды разработки



